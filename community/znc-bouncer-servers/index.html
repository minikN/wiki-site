<!DOCTYPE html><html lang="en"><head><!--  --><meta charset="utf-8"/><meta author="David Wilson"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="/css/bootstrap.min.css"/><link rel="stylesheet" href="/fonts/iosevka-aile/iosevka-aile.css"/><link rel="stylesheet" href="/fonts/jetbrains-mono/jetbrains-mono.css"/><link rel="stylesheet" href="/css/code.css"/><link rel="stylesheet" href="/css/site.css"/><script defer="defer" data-domain="wiki.systemcrafters.net" src="https://plausible.io/js/plausible.js"></script><title>ZNC Bouncer Server Setup - System Crafters</title></head><body><div><div class="blog-header"><div class="container"><div class="row align-items-center justify-content-between"><div class="col-sm-12 col-md-8"><div class="blog-title">System Crafters</div></div><div class="col-sm col-md"><div class="blog-description text-sm-left text-md-right text-lg-right text-xl-right"></div></div></div></div></div><div class="blog-masthead"><div class="container"><div class="row align-items-center justify-content-between"><div class="col-sm-12 col-md-12"><nav class="nav"><a class="nav-link" href="/">Main Page</a> <a class="nav-link" href="/emacs">GNU Emacs</a> <a class="nav-link" href="/guix">GNU Guix</a><a class="nav-link" href="https://systemcrafters.net">System Crafters Home</a><form class="navbar-form navbar-right" role="search" action="https://duckduckgo.com/"><div class="form-group"><input type="text" name="q" class="form-control" placeholder="Search Wiki" style="overflow: hidden;margin-top: 3%;margin-bottom: 2%;"/><input type="hidden" name="sites" value="wiki.systemcrafters.net"/></div></form> </nav></div></div></div></div></div><div class="container"><div class="row"><div class="col-sm-12 blog-main"><div class="blog-post"><h1 class="blog-post-title">ZNC Bouncer Server Setup</h1><p class="blog-post-meta"></p><div><p>An IRC bouncer server stays connected to IRC at all times on your behalf so that when you connect to it you can read all the messages that were sent to your channels while you were offline. This allows you to disconnect your client from the IRC server without losing context for the conversation or missing potentially relevant messages. When you reconnect, the ZNC bouncer server provides a replay of the conversation you missed while you were gone.
</p>

<p>Several members of the System Crafters community are running their own ZNC servers. Below is a tutorial for setting up a TLS/SSL enabled bouncer server using ZNC, Let's Encrypt, and CentOS. There has been some discussion about providing a multi-user server that members of the System Crafters community can use. Please contact <kbd>#systemcrafters</kbd> IRC users daviwil or nackjicholson if you would be interested in using a community bouncer server. The features of ZNC enable clearer and more fluid communication. We enjoy using IRC and want to know if a community ZNC bouncer server would be well utilized and beneficial for our communication.
</p>

<h2><a id="external-resources" class="anchor" href="#external-resources">¶</a>External Resources</h2><ul><li><a href="https://wiki.znc.in/ZNC">ZNC Wiki</a></li>
<li><a href="https://wiki.znc.in/Signed_SSL_certificate#LetsEncrypt">ZNC Wiki - Signed SSL Certificate with Let's Encrypt</a></li>
<li><a href="https://sgfault.com/2018/07/28/irc-bouncer-setup.html">Blog: Setting Up an IRC Bouncer</a></li>
<li><a href="https://www.vultr.com/docs/installing-and-configuring-znc-on-centos-7">Blog: Vultr - Installing and Configuring ZNC on CentOS 7</a></li>
</ul>

<h2><a id="tutorial-znc-with-ssltls-on-centos" class="anchor" href="#tutorial-znc-with-ssltls-on-centos">¶</a>Tutorial: ZNC with SSL/TLS on CentOS</h2><p>The following commands and configuration instructions will set up a secure ZNC server for personal use. You will need a CentOS 7 server or virtual machine, as well as a registered domain name. In the tutorial znc.example.org will be used as the target domain name, and the ZNC server will be configured to run on port 6697.
</p>

<h3><a id="install" class="anchor" href="#install">¶</a>Install</h3><pre><code class="sh">$ sudo yum update
$ sudo yum install certbot znc
</code></pre>

<h3><a id="firewall" class="anchor" href="#firewall">¶</a>Firewall</h3><p>Opening necessary ports for certbot and ZNC.
</p>

<pre><code class="sh">$ sudo firewall-cmd --zone=public --permanent --add-service=http
$ sudo firewall-cmd --zone=public --permanent --add-service=https
$ sudo firewall-cmd --add-port=6697/tcp
$ sudo firewall-cmd --runtime-to-permanent
</code></pre>

<h3><a id="use-a-lets-encrypt-certificate-with-znc" class="anchor" href="#use-a-lets-encrypt-certificate-with-znc">¶</a>Use a Let's Encrypt Certificate with ZNC</h3><p>Let's Encrypt is a service that enables people to use SSL encryption more easily on the internet. Signed and verified certificates can be acquired using a simple CLI tool called <kbd>certbot</kbd>. The certificates expire rather quickly, and this is why auto-renewal steps are also shown below.
</p>

<pre><code class="sh">$ sudo certbot certonly --standalone --preferred-challenges http --http-01-port 80 -d znc.example.org
</code></pre>

<p>In order to work over SSL, ZNC expects a combined cert file <kbd>znc.pem</kbd> to be accessible to it in the znc home path <kbd>/var/lib/znc/.znc</kbd>.
</p>

<pre><code class="sh">$ sudo cat /etc/letsencrypt/live/znc.example.org/{privkey,fullchain}.pem &gt; znc.pem
$ sudo mv znc.pem /var/lib/znc/.znc/
$ sudo chown znc:znc /var/lib/znc/.znc/znc.pem
</code></pre>

<p>Make a crontab and renewal script to automatically check Let's Encrypt for certificate updates, and trigger a change to <kbd>znc.pem</kbd> when certificates are renewed.
</p>

<pre><code class="sh">$ sudo touch /etc/letsencrypt/renewal-hooks/deploy/update-znc.pem
$ sudo chmod +x /etc/letsencrypt/renewal-hooks/deploy/update-znc.pem
</code></pre>

<p>Copy the following into the <kbd>update-znc.pem</kbd> file using a text editor i.e. <kbd>sudo vi /etc/letsencrypt/renewal-hooks/deploy/update-znc.pem</kbd>.
</p>

<pre><code class="bash"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span>
<span class="org-variable-name">YOURDOMAIN</span>=<span class="org-string">"znc.example.org"</span>

[[ $<span class="org-variable-name">RENEWED_LINEAGE</span> != <span class="org-string">"/etc/letsencrypt/live/$YOURDOMAIN"</span> ]] &amp;&amp; <span class="org-keyword">exit</span> 0
<span class="org-builtin">echo</span> <span class="org-string">"Updating certs"</span>
cat /etc/letsencrypt/live/$<span class="org-variable-name">YOURDOMAIN</span>/{privkey,fullchain}.pem &gt; /var/lib/znc/.znc/znc.pem
</code></pre>

<p>Add this to cron by running <kbd>crontab -e</kbd>. This will attempt renewal everyday at 3:15 a.m. you can change this time to any time you like.
</p>

<pre><code class="nil">15 3 * * * /usr/bin/certbot renew --quiet
</code></pre>

<p>Running ZNC.
</p>

<pre><code class="sh">$ sudo -u znc znc --makeconf
</code></pre>

<p>Fill in the subsequent prompts with details that make sense for yourself.
</p>

<pre><code class="nil">[ ?? ] Username (alphanumeric): willvaughn
[ ?? ] Enter password:
[ ?? ] Confirm password:
[ ?? ] Nick [willvaughn]: nackjicholson
[ ?? ] Alternate nick [nackjicholson_]:
[ ?? ] Ident [willvaughn]: nackjicholson
[ ?? ] Real name (optional): William Vaughn
[ ?? ] Bind host (optional):
[ ** ] Enabled user modules [chansaver, controlpanel]
[ ** ]
[ ?? ] Set up a network? (yes/no) [yes]:
[ ** ]
[ ** ] -- Network settings --
[ ** ]
[ ?? ] Name [freenode]: libera
[ ?? ] Server host (host only): irc.libera.chat
[ ?? ] Server uses SSL? (yes/no) [no]: yes
[ ?? ] Server port (1 to 65535) [6697]: 6697
[ ?? ] Server password (probably empty):
[ ?? ] Initial channels:
</code></pre>

<p>Run the ZNC systemd service.
</p>

<pre><code class="sh">$ sudo systemctl start znc
$ sudo systemctl enable znc
</code></pre>

<p>You should now be able to visit znc.example.com:6697 to use the ZNC web frontend. You can also connect to ZNC using <kbd>erc-tls</kbd>. If your browser blocks the 6697 port, read up on configuring settings to work around that on the znc wiki <a href="https://wiki.znc.in/FAQ#How_can_I_access_webadmin_with_my_browser.3F">here</a>.
</p>

<pre><code class="emacs-lisp">(erc-tls <span class="org-builtin">:server</span> <span class="org-string">"znc.example.org"</span> <span class="org-builtin">:port</span> 6697 <span class="org-builtin">:nick</span> <span class="org-string">"nackjicholson"</span> <span class="org-builtin">:password</span> <span class="org-string">"willvaughn/libera:&lt;my-znc-user-password&gt;"</span>)
</code></pre>
<h2><a id="tips-tricks-and-troubleshooting" class="anchor" href="#tips-tricks-and-troubleshooting">¶</a>Tips, Tricks, and Troubleshooting</h2><p>Please add your own timps and tricks by editing the wiki.
</p>

<h3><a id="fixing-your-nick" class="anchor" href="#fixing-your-nick">¶</a>Fixing your nick</h3><p>Occasionally, the ZNC server may log you in as your alternate name. Usually that will mean that your name will have a trailing <kbd>_</kbd> on it. If you get stuck like that and it's not because your main nick is also logged in on another client, there is a trick to switching back to the main nick. By typing <kbd>/nick &lt;your-desired-name&gt;</kbd> in your client you can trigger the ZNC server to configure a different nickname for this session. Then quitting and reconnecting should use the changed nickname that is configured.
</p>
</div></div></div></div></div><footer class="blog-footer"><div class="container"><div class="row"><div class="col-sm col-md text-sm-left text-md-right text-lg-right text-xl-right"><p>Made with Emacs 27.2 (Org mode 9.4.4)</p><p><a href="https://systemcrafters.net/privacy-policy/">Privacy Policy</a></p></div></div></div></footer><script src="/js/bootstrap.bundle.min.js"/></body></html>
