<!DOCTYPE html><html lang="en"><head><!--  --><meta charset="utf-8"/><meta author="David Wilson"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="/css/bootstrap.min.css"/><link rel="stylesheet" href="/fonts/iosevka-aile/iosevka-aile.css"/><link rel="stylesheet" href="/fonts/jetbrains-mono/jetbrains-mono.css"/><link rel="stylesheet" href="/css/code.css"/><link rel="stylesheet" href="/css/site.css"/><script defer="defer" data-domain="wiki.systemcrafters.net" src="https://plausible.io/js/plausible.js"></script><title>Nonguix Installation Guide - System Crafters</title></head><body><div><div class="blog-header"><div class="container"><div class="row align-items-center justify-content-between"><div class="col-sm-12 col-md-8"><div class="blog-title">System Crafters</div></div><div class="col-sm col-md"><div class="blog-description text-sm-left text-md-right text-lg-right text-xl-right"></div></div></div></div></div><div class="blog-masthead"><div class="container"><div class="row align-items-center justify-content-between"><div class="col-sm-12 col-md-12"><nav class="nav"><a class="nav-link" href="/">Main Page</a> <a class="nav-link" href="/emacs">GNU Emacs</a> <a class="nav-link" href="/guix">GNU Guix</a><a class="nav-link" href="https://systemcrafters.net">System Crafters Home</a><form class="navbar-form navbar-right" role="search" action="https://duckduckgo.com/"><div class="form-group"><input type="text" name="q" class="form-control" placeholder="Search Wiki" style="overflow: hidden;margin-top: 3%;margin-bottom: 2%;"/><input type="hidden" name="sites" value="wiki.systemcrafters.net"/></div></form> </nav></div></div></div></div></div><div class="container"><div class="row"><div class="col-sm-12 blog-main"><div class="blog-post"><h1 class="blog-post-title">Nonguix Installation Guide</h1><p class="blog-post-meta"></p><div><p>This document is a guide for installing GNU Guix using the live system
booted from a <kbd>nonguix</kbd> installation medium. The installation medium
is provided by a GitHub Action from System Crafters, and uses the full
Linux kernel, as opposed to the libre one. This allows for more driver
support, such as WiFi on many modern laptops, and makes the
installation process much easier.
</p>

<p>Before installing, it would be advised to view the <a href="/guix/faqs">FAQs</a>.
</p>

<p>For installations of software and specific issues, please search for
your topic or look in the categories.
</p>

<p>GNU Guix should run on most x86-64 compatible PCs. As the installation
process needs to retrieve packages from a remote repository, this
guide assumes a working internet connection is available. The Nonguix
installation medium should cover WiFi issues normally present in the
Guix installer.
</p>

<h2><a id="table-of-contents" class="anchor" href="#table-of-contents">¶</a>Table of Contents</h2><ul><li><a href="#pre-installation">Pre-installation</a>
<ul><li><a href="#download-the-installation-image">Download the installation image</a></li>
<li><a href="#booting">Booting</a></li>
<li><a href="#connecting-to-the-internet">Connecting to the internet</a></li>
<li><a href="#partition-the-disks">Partition the disks</a></li>
</ul></li>
<li><a href="#installation">Installation</a>
<ul><li><a href="#herd-store">Herd store</a></li>
<li><a href="#system-configuration">System configuration</a></li>
<li><a href="#channels">Channels</a></li>
<li><a href="#update-system-configuration">Update system configuration</a></li>
<li><a href="#initialize-system">Initialize system</a></li>
</ul></li>
<li><a href="#post-installation">Post-installation</a>
<ul><li><a href="#user-accounts">User accounts</a></li>
<li><a href="#dotfiles">Dotfiles</a></li>
<li><a href="#channels-1">Channels</a></li>
<li><a href="#general-recommendations">General recommendations</a></li>
</ul></li>
<li><a href="#further-reading">Further Reading</a></li>
</ul>

<h2><a id="pre-installation" class="anchor" href="#pre-installation">¶</a>Pre-installation</h2><h3><a id="download-the-installation-image" class="anchor" href="#download-the-installation-image">¶</a>Download the installation image</h3><p>The installation image is kept at a repo in the System Crafters
organization. Click <a href="https://github.com/SystemCrafters/guix-installer/releases/latest">here</a> to download the latest ISO. Burn this ISO to
an installation medium (flash drive or DVD), and boot from it. For
example, to burn it to a USB flash drive at <kbd>/dev/sdX</kbd>, run the
following command:
</p>

<pre><code class="sh">dd <span class="org-variable-name">if</span>=guix-installer.iso <span class="org-variable-name">of</span>=/dev/sdX <span class="org-variable-name">status</span>=progress <span class="org-variable-name">bs</span>=4M
</code></pre>

<h3><a id="booting" class="anchor" href="#booting">¶</a>Booting</h3><p>Boot from the installation medium, select your language and country,
and select "Install using the shell based process" when
prompted. Although this makes the installation slightly more
difficult, it allows for setting up your new installation with the
full Linux kernel (necessary for the nonfree installation.)
</p>

<h3><a id="connecting-to-the-internet" class="anchor" href="#connecting-to-the-internet">¶</a>Connecting to the internet</h3><p>If you have ethernet, simply plug in your cable and continue to the
next step. If you have WiFi, use an editor (or <kbd>echo</kbd>) to create a new
file called <kbd>wifi.conf</kbd> to store the WiFi configuration. Make sure to
set <kbd>ssid</kbd> to the name of your WiFi network name, and <kbd>psk</kbd> to the
passphrase for your WiFi. You may also need to change the <kbd>key_mgmt</kbd>
parameter depending on the type of authentication your wifi router
supports.
</p>

<pre><code class="sh"><span class="org-variable-name">network</span>={
  <span class="org-variable-name">ssid</span>=<span class="org-string">"ssid-name"</span>
  <span class="org-variable-name">key_mgmt</span>=WPA-PSK
  <span class="org-variable-name">psk</span>=<span class="org-string">"unencrypted passphrase"</span>
}
</code></pre>

<p>Next, run the following commands to unblock the WiFi card, determine
its device name, and connect using the device name received. In the
example, the name is <kbd>wlp4s0</kbd>, so <kbd>wpa_supplicant</kbd> is passed the flag
<kbd>-i wlp4s0</kbd>. Change this accordingly:
</p>

<pre><code class="sh">rfkill unblock all
ifconfig -a
wpa_supplicant -c wifi.conf -i wlp4s0 -B
</code></pre>

<p>Finally, run <kbd>dhclient</kbd> to turn on DNS, remembering to replace
<kbd>wlp4s0</kbd> with your device name returned from <kbd>ifconfig -a</kbd>:
</p>

<pre><code class="sh">dhclient -v wlp4s0
</code></pre>

<h3><a id="partition-the-disks" class="anchor" href="#partition-the-disks">¶</a>Partition the disks</h3><p>When disks are detected by the system, they are assigned a block
device. To list these block devices, run <kbd>lsblk</kbd> or <kbd>fdisk -l</kbd>.
</p>

<p>For example, running <kbd>lsblk</kbd> on my laptop returns these results:
</p>

<pre><code class="sh">$ lsblk

NAME          MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT
sda             8:0    0 465.8G  0 disk
&#9500;&#9472;sda1          8:1    0   549M  0 part  /boot/efi
&#9500;&#9472;sda2          8:2    0 153.5G  0 part
&#9474; &#9492;&#9472;cryptroot 253:0    0 153.5G  0 crypt /
&#9492;&#9472;sda3          8:3    0 311.7G  0 part
  &#9492;&#9472;crypthome 253:1    0 311.7G  0 crypt /home
sr0            11:0    1  1024M  0 rom
</code></pre>

<p>I have an encrypted root and home (if you don't know what that is,
don't worry, it just means I have to put in two passwords before I can
use my computer), so my devices might appear differently than yours,
but the rough idea is the same. You might have no partitions (the
numbered versions, such as <kbd>/dev/sda1</kbd>) if you just wiped your drive,
or many if you are coming from a different GNU/Linux OS or Windows.
</p>

<h4><a id="encrypted" class="anchor" href="#encrypted">¶</a>Encrypted</h4><p>If you would like to have encrypted block devices (entire partitions),
use LUKS. If you do not want encryption, continue reading at
"Regular."
</p>

<p>Your encrypted blocks can be all or none, however in this example only
the root will be encrypted and UEFI will be used. If unsure, look at
"Regular" and see the potential layouts (or read the linked article
for the Arch Wiki there).
</p>

<table class="table table-dark"><thead class="thead-dark"><tr><td>Mount point</td><td>Partition</td><td>Partition type</td><td>Suggested size</td></tr></thead>
<tbody><tr><td><kbd>/mnt/boot/efi</kbd></td><td><kbd>/dev/efi_system_partition</kbd></td><td>EFI system partition</td><td>At least 260 MiB</td></tr>
<tr><td><kbd>[SWAP]</kbd></td><td><kbd>/dev/swap_partition</kbd></td><td>Linux swap</td><td>More than 512 MiB</td></tr>
<tr><td><kbd>/mnt</kbd></td><td><kbd>/dev/root_partition</kbd></td><td>Linux x86-64 root (/)</td><td>Remainder of the device</td></tr></tbody>
</table>

<pre><code class="sh">cfdisk /dev/root_partition
</code></pre>

<p>Once your partitions are created, you can enable LUKS on the root
partition by running the following commands. You can change
<kbd>system-root</kbd> to whatever you desire:
</p>

<pre><code class="sh">cryptsetup luksFormat /dev/root_partition
cryptsetup open --type luks /dev/root_partition system-root
mkfs.ext4 -L system-root /dev/mapper/system-root
mount <span class="org-variable-name">LABEL</span>=system-root /mnt
</code></pre>

<p>Finally, ensure your EFI system partition and swap are both
activated/mounted:
</p>

<pre><code class="sh">mkdir -p /mnt/boot/efi
mount /dev/efi_system_partition /mnt/boot/efi

swapon /dev/swap_partition
</code></pre>

<p>Proceed to "Installation."
</p>

<h4><a id="regular" class="anchor" href="#regular">¶</a>Regular</h4><p>If you would not like to have encrypted block devices (entire
partitions), you can partition your drives just as you would for any
other GNU/Linux OS. For example, you could have the following layout
(as suggested by the Arch Wiki) if using UEFI (most modern computers):
</p>

<table class="table table-dark"><thead class="thead-dark"><tr><td>Mount point</td><td>Partition</td><td>Partition type</td><td>Suggested size</td></tr></thead>
<tbody><tr><td><kbd>/mnt/boot/efi</kbd></td><td><kbd>/dev/efi_system_partition</kbd></td><td>EFI system partition</td><td>At least 260 MiB</td></tr>
<tr><td><kbd>[SWAP]</kbd></td><td><kbd>/dev/swap_partition</kbd></td><td>Linux swap</td><td>More than 512 MiB</td></tr>
<tr><td><kbd>/mnt</kbd></td><td><kbd>/dev/root_partition</kbd></td><td>Linux x86-64 root (/)</td><td>At least 1/3 of your device</td></tr>
<tr><td><kbd>/mnt/home</kbd></td><td><kbd>/dev/home_partition</kbd></td><td>Linux x86-64 home (/home)</td><td>Remainder of the device</td></tr></tbody>
</table>

<p>For BIOS with MBR, the Arch Wiki suggests the following:
</p>

<table class="table table-dark"><thead class="thead-dark"><tr><td>Mount point</td><td>Partition</td><td>Partition type</td><td>Suggested size</td></tr></thead>
<tbody><tr><td><kbd>[SWAP]</kbd></td><td><kbd>/dev/swap_partition</kbd></td><td>Linux swap</td><td>More than 512 MiB</td></tr>
<tr><td><kbd>/mnt</kbd></td><td><kbd>/dev/root_partition</kbd></td><td>Linux</td><td>At least 1/3 of your device</td></tr>
<tr><td><kbd>/mnt/home</kbd></td><td><kbd>/dev/home_partition</kbd></td><td>Linux</td><td>Remainder of the device</td></tr></tbody>
</table>

<p>Many other partitioning schemes exist: if you'd like to try other ones
or learn about your options, check out the Arch Wiki's page for
<a href="https://wiki.archlinux.org/title/Partitioning#Example_layouts">partitioning</a>.
</p>

<p>Partition your disks using either <kbd>cfdisk</kbd> or <kbd>fdisk</kbd>:
</p>

<pre><code class="sh">cfdisk /dev/sdX

fdisk /dev/sdX
</code></pre>

<p>Next, you should format your partitions with the correct file
system. To create an Ext4 file system on <kbd>/dev/root_partition</kbd>, run:
</p>

<pre><code class="sh">mkfs.ext4 /dev/root_partition
</code></pre>

<p>To initialize swap, run the following command:
</p>

<pre><code class="sh">mkswap /dev/swap_partition
</code></pre>

<p>Now it is time to mount your partitions. This will change depending on
your chosen layout, but all drives are mounted as such:
</p>

<pre><code class="sh">mount /dev/partition_name /mnt
</code></pre>

<p>Replace <kbd>partition_name</kbd> with the partition's name, and <kbd>/mnt</kbd> with
the necessary location. The following locations are used:
</p>

<ul><li>Root partition: <kbd>/mnt</kbd></li>
<li>Home partition: <kbd>/mnt/home</kbd></li>
<li>EFI system partition: <kbd>/mnt/boot/efi</kbd></li>
</ul>

<p>In order to mount a partition, that directory (folder) needs to
exist. For <kbd>/mnt/home</kbd> and <kbd>/mnt/boot/efi</kbd> (if created) create the
directories as follows <em>after</em> mounting <kbd>/mnt</kbd>:
</p>

<pre><code class="sh">mkdir -p /mnt/boot/efi

mkdir -p /mnt/home
</code></pre>

<p>Swap is activated with the <kbd>swapon</kbd> command:
</p>

<pre><code class="sh">swapon /dev/swap_partition
</code></pre>

<h2><a id="installation" class="anchor" href="#installation">¶</a>Installation</h2><h3><a id="herd-store" class="anchor" href="#herd-store">¶</a>Herd store</h3><p>Once all partitions are mounted, you can begin the
installation. First, set up the installation environment using <kbd>herd</kbd>:
</p>

<pre><code class="sh">herd start cow-store /mnt
</code></pre>

<h3><a id="system-configuration" class="anchor" href="#system-configuration">¶</a>System configuration</h3><p>The following steps will change depending on your approach. If you've
used Guix in the past and would like to use your dotfiles and system
configuration (your custom configurations), clone your repository now.
</p>

<p>If you would like to make your own, you need to at least have the
nonguix channels setup for the installation medium. If you aren't sure
what that means, or how to do that yourself, follow the instructions
below for now, only copying the <kbd>channels.scm</kbd>.
</p>

<p>If you do not have personal dotfiles yet, and would like to try David
Wilson's, clone the following repository using <kbd>git</kbd> into your current
directory (i.e. not <kbd>/mnt</kbd>):
</p>

<pre><code class="sh">git clone https://github.com/daviwil/dotfiles
</code></pre>

<h3><a id="channels" class="anchor" href="#channels">¶</a>Channels</h3><p>Regardless of your path, you should now add the nonguix and necessary
custom channels to the installation medium. Run the following commands
to set up the necessary channels and run <kbd>guix pull</kbd> (equivalent to
<kbd>apt update</kbd>, updates the files available without updating the ones on
the system):
</p>

<pre><code class="sh">mkdir -p ~/.config/guix
<span class="org-comment-delimiter"># </span><span class="org-comment">If you cloned David Wilson's dotfiles:</span>
cp dotfiles/guix/channels.scm ~/.config/guix
<span class="org-comment-delimiter"># </span><span class="org-comment">Otherwise, add the channels.scm file yourself and edit it with nonguix and your necessary channels</span>
guix pull
<span class="org-comment-delimiter"># </span><span class="org-comment">This is necessary to ensure the updated profile path is active!</span>
<span class="org-builtin">hash</span> guix
</code></pre>

<p>The pull operation can take quite a while, depending upon your machine
and the last time the nonguix installation ISO was updated. I'd
recommend getting a cup of coffee (or tea, or whatever your preferred
beverage is!)
</p>

<h3><a id="update-system-configuration" class="anchor" href="#update-system-configuration">¶</a>Update system configuration</h3><p>Once the operation is finished, you will need to update your
configuration to point to your partition UUIDs and labels for the
system that you are installing. In order to get your UUIDs, run the
following command:
</p>

<pre><code class="sh">blkid
</code></pre>

<p>This will return a long list of IDs that you can write down, take a
picture of, <kbd>cat</kbd> or <kbd>echo</kbd> into your configuration, depending on
which is more comfortable to you (if you're not too familiar with
GNU/Linux, I'd recommend writing the IDs down. They are long, but it
is faster and safer in the long run.) You can also switch to another
TTY using <kbd>Ctrl-Alt-F#</kbd> and press <kbd>Enter</kbd> or <kbd>Return</kbd> to get to
another root prompt. You can then switch back and forth between the
previous TTY on <kbd>F3</kbd> instead of writing down your IDs.
</p>

<p>If you have encrypted partitions, yyou can use the following command
to find the UUID:
</p>

<pre><code class="sh">cryptsetup luksUUID /dev/root_partition
</code></pre>

<h3><a id="initialize-system" class="anchor" href="#initialize-system">¶</a>Initialize system</h3><p>Finally, we can initialize the system by running the following command:
</p>

<pre><code class="sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Change the .dotfiles directory to your dotfiles if necessary</span>
guix system -L ~/.dotfiles/.config/guix/systems init path/to/config.scm /mnt
</code></pre>

<p>This can take a <em>very</em> long time depending on your internet connection
and computer. If using a laptop, please ensure it is plugged in. If
any errors occur during the installation, simply resume the
installation as the Guix store has the previous packages saved. If the
error continues, consider contacting someone at the System Crafters'
Discord, IRC, or Matrix "Links?" &lt;placeholder&gt;.
</p>

<h2><a id="post-installation" class="anchor" href="#post-installation">¶</a>Post-installation</h2><h3><a id="user-accounts" class="anchor" href="#user-accounts">¶</a>User accounts</h3><p>Congratulations! Your GNU Guix System installation is (almost)
complete. Reboot your system, take out your installation medium, and
login as root when you are faced with a login prompt. Your last
crucial step is to add a password for your accounts. Once logged in,
run the following commands:
</p>

<pre><code class="sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Set the password for your root account</span>
passwd
<span class="org-comment-delimiter"># </span><span class="org-comment">Set the password for your user</span>
passwd &lt;your username&gt;
</code></pre>

<p>Log out, and log into your user account.
</p>

<h3><a id="dotfiles" class="anchor" href="#dotfiles">¶</a>Dotfiles</h3><p>Clone your dotfiles repository (or David Wilson's again) and ensure
that the channels include nonguix. If using David Wilson's dotfiles,
<kbd>cd</kbd> into the directory and run:
</p>

<pre><code class="sh">stow .
</code></pre>

<p>If using your own dotfiles, you know how to deploy them. If you don't
have a good way to deploy your dotfiles yet, consider using <kbd>stow</kbd>
"Link?" &lt;placeholder&gt;.
</p>

<h3><a id="channels" class="anchor" href="#channels">¶</a>Channels</h3><p>Verify that your <kbd>channels.scm</kbd> file is in the target path
(<kbd>\~/.config/guix</kbd>) and then run the following to update your
channels:
</p>

<pre><code class="sh">guix pull
</code></pre>

<h3><a id="general-recommendations" class="anchor" href="#general-recommendations">¶</a>General recommendations</h3><p>You can now install whatever packages or manifests you need and
have. If you are new to GNU Guix, continue reading at the "Basics of
GNU GUIX" page &lt;placeholder&gt;. If interested in basic system setups and
advice, continue reading at <a href="/guix/general-recommendations">general recommendations</a>. Otherwise, once
again, congratulations!  You have officially installed a
nonfree/nonguix Guix System!
</p>

<h2><a id="further-reading" class="anchor" href="#further-reading">¶</a>Further Reading</h2><p>For more information, and to read the official installation guide,
look at the following links:
</p>
<ul><li><a href="https://guix.gnu.org/manual/devel/en/html_node/System-Installation.html#System-Installation">Installation in the Guix manual</a></li>
<li><a href="https://gitlab.com/nonguix/nonguix/">Nonguix GitLab repository</a></li>
</ul>
</div></div></div></div></div><footer class="blog-footer"><div class="container"><div class="row"><div class="col-sm col-md text-sm-left text-md-right text-lg-right text-xl-right"><p>Made with Emacs 27.2 (Org mode 9.4.4)</p><p><a href="https://systemcrafters.net/privacy-policy/">Privacy Policy</a></p></div></div></div></footer><script src="/js/bootstrap.bundle.min.js"/></body></html>
